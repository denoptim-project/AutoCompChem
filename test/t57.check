#!/bin/bash

grep -q -i "NWChem Error Recognized: Step 3 returned Error Message: test2_ONLY_FOR_TEST" t57.log
if [ $? != 0 ] ; then
echo NOT Passed ERROR 1
exit -1
fi

grep -i -q "NWChem output file contains: 3 steps" t57.log
if [ $? != 0 ] ; then
echo NOT Passed ERROR 3
exit -1
fi

n=$(grep -c -i DRIVER restart-t57.jd )
if [ $n != 4 ] ; then
echo NOT Passed ERROR 4
exit -1
fi

n=$(grep -c "Additional step " restart-t57.jd )
if [ $n != 2 ] ; then
echo NOT Passed ERROR 5
exit -1
fi

n=$(grep -c -i  START restart-t57.jd )
if [ $n != 1 ] ; then
echo NOT Passed ERROR 6
exit -1
fi

n=$(grep -c -i "Additional step 1 in attempt to fix: Step3: geometry optimization" restart-t57.jd )
if [ $n != 1 ] ; then
echo NOT Passed ERROR 7
exit -1
fi

n=$(grep -c -i "END-OF-TASK" restart-t57.jd)
if [ $n != 5 ] ; then
echo NOT Passed ERROR 8
exit -1
fi

n=$(grep -c -i "density=0.0001" restart-t57.jd)
if [ $n != 1 ] ; then
echo NOT Passed ERROR 9
exit -1
fi

n=$(grep -c -i DRIVER restart-t57.nw )
if [ $n != 2 ] ; then
echo NOT Passed ERROR 10
exit -1
fi

n=$(grep -c -i "TITLE[[:space:]]*\" Additional step " restart-t57.nw )
if [ $n != 2 ] ; then
echo NOT Passed ERROR 11
exit -1
fi

n=$(grep -c -i START restart-t57.nw )
if [ $n != 1 ] ; then
echo NOT Passed ERROR 12
exit -1
fi

n=$(grep -c -i "^TASK " restart-t57.nw)
if [ $n != 6 ] ; then
echo NOT Passed ERROR 13
exit -1
fi

n=$(grep -c -i "^TASK[[:space:]]*dft[[:space:]]*optimize" restart-t57.nw)
if [ $n != 4 ] ; then
echo NOT Passed ERROR 14
exit -1
fi

n=$(grep -c -i "CONVERGENCE[[:space:]]*density[[:space:]]*0.0001[[:space:]]*energy[[:space:]]*1e-6" restart-t57.nw)
if [ $n != 1 ] ; then
echo NOT Passed ERROR 15
exit -1
fi
grep -q 'Termination status: 0' t57.log
if [ $? == 0 ] ; then 
echo Passed
exit 0
else
echo NOT Passed ERROR 16
exit -1
fi
